<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Sheets Search and Filter</title>
    
    <style>
        table, th, td {
            border: 1px solid black;
            border-collapse: collapse;
            padding: 8px;
        }
    </style>
</head>
<body>

    <h1>Search and Filter Google Sheets Data</h1>

    <!-- Search input field -->
    <input type="text" id="search-input" placeholder="Search...">

    <br><br>

    <!-- Table to display data -->
    <table id="excel-table">
        <thead>
            <tr id="table-header"></tr>
        </thead>
        <tbody id="table-body"></tbody>
    </table>
	<div id="update-link-container">
            <h3>Update Google Sheet Link</h3>
            <input type="text" id="password-input" placeholder="Enter password to update link">
            <button id="update-link-btn">Update Link</button>
            <p id="feedback"></p>
        </div>
    <script>
        // Replace with your actual Google Sheet's export CSV link
        const googleSheetUrl = "https://docs.google.com/spreadsheets/d/1CIXqlAczg5xh0eB0D7Itje9fWXG-y0ZtVFVA-lBoWDE/export?format=csv"; 
	const correctPassword = "mySecurePassword"; 
        let sheetData = [];
        let headers = [];

        // Fetch CSV from Google Sheets
        fetch(googleSheetUrl)
            .then(response => response.text())
            .then(csv => {
                parseCSV(csv);
            })
            .catch(error => console.error('Error fetching the Google Sheet:', error));

        // Function to parse CSV data manually
        function parseCSV(csv) {
            // Split the CSV data into rows
            const rows = csv.split("\n");
            
            // Get the headers (first row)
            headers = rows[0].split(","); // Split by commas for each column
            
            // Process remaining rows as data
            sheetData = rows.slice(1).map(row => row.split(","));

            renderTable();
        }

        // Function to render the table with data
        function renderTable() {
            // Clear the table
            const headerRow = document.getElementById('table-header');
            const bodyRow = document.getElementById('table-body');

            // Add headers to the table
            headers.forEach(header => {
                const th = document.createElement('th');
                th.textContent = header;
                headerRow.appendChild(th);
            });

            // Add data to the table
            sheetData.forEach(row => {
                const tr = document.createElement('tr');
                row.forEach(cell => {
                    const td = document.createElement('td');
                    td.textContent = cell;
                    tr.appendChild(td);
                });
                bodyRow.appendChild(tr);
            });
        }

        // Filter the table based on search input
        document.getElementById('search-input').addEventListener('input', function() {
            const searchText = this.value.toLowerCase();
            const filteredData = sheetData.filter(row => {
                return row.some(cell => cell.toString().toLowerCase().includes(searchText));
            });
            renderFilteredTable(filteredData);
        });

        function renderFilteredTable(filteredData) {
            // Clear the table body
            const bodyRow = document.getElementById('table-body');
            bodyRow.innerHTML = '';

            // Add filtered data to the table
            filteredData.forEach(row => {
                const tr = document.createElement('tr');
                row.forEach(cell => {
                    const td = document.createElement('td');
                    td.textContent = cell;
                    tr.appendChild(td);
                });
                bodyRow.appendChild(tr);
            });
        }

	    // Handle password input to update Google Sheets link
        document.getElementById('update-link-btn').addEventListener('click', function() {
            const enteredPassword = document.getElementById('password-input').value;

            if (enteredPassword === correctPassword) {
                const newLink = prompt("Enter the new Google Sheets CSV link:");

                if (newLink) {
                    googleSheetUrl = newLink; // Update the URL
                    fetchSheetData(); // Re-fetch the data with the new link
                    document.getElementById('feedback').style.display = 'none';
                }
            } else {
                document.getElementById('feedback').textContent = "Incorrect password!";
                document.getElementById('feedback').style.display = 'block';
            }
        });
    </script>

</body>
</html>
